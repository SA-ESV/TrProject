# Разбор сценария

## Наименование UC
Возврат заказа Клиентом

## Код UC
UC-5

## Действующие лица:
* Клиент
* Администратор магазина
* Веб-сайт магазина (далее Система)
* Сервис платежей Payture 

## Триггер
Клиент возвращает заказ в магазин

## Предусловия
Клиент возвращает ранее оформленный заказ. 
<br>Оплата по заказу была выполнена.
<br>Возврат заказа ранее не проводился.
<br>Оформляется возврат всего заказа целиком (не частичный возврат).
<br>Администратор успешно авторизовался в системе.

## Постусловия
Успешно проведен возврат денежных средств Клиента в Payture
<br>В Системе успешно сохранен результат возврата

## Основной поток
1. Клиент возвращает заказ в магазин
2. Администратор магазина забирает заказ
3. Администратор магазина совершает поиск нужного заказа в Системе
4. Администратор магазина оформляет возврат на заказ в Системе
5. Администратор магазина оформляет возврат денежных средств Клиенту за заказ
6. Система удерживает с суммы заказа - суммы доставки
7. Система отправляет в Payture операцию возврата денежных средств по платежу Клиента (с учетом удержания суммы доставки) - vwapi/Refund
8. Payture обрабатывает возврат
9. Payture передает в Систему результат обработки возврата
10. Система убеждается, что операция возврата прошла успешна
11. Система сохраняет результат возврата и отображает его Администратору магазина
12. Администратор магазина сообщает Клиент об успешном завершение возврата

## Расширения (Альтернатива, Исключения)
3а. Нужный заказ не найден в Системе

4а. По возвращаемому заказу в Системе уже оформлен ранее возврат

5а. Карта клиента, которой был оплачен заказ, заблокирована или утрачена

7а. Сервис платежей Payture недоступен

10а. Статус платежа в Payture **не** Charged

10б. После совершения списания прошло более 180 дней