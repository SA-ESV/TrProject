# Разбор сценария

## Наименование UC
Возврат заказа Клиентом

## Код UC
UC-5

## Действующие лица:
* Клиент
* Администратор магазина
* Веб-сайт магазина (далее Система)
* Сервис платежей Payture 

## Триггер
Клиент возвращает заказ в магазин

## Предусловия
Клиент возвращает ранее оформленный заказ. 
<br>Администратор успешно авторизовался в системе.

## Постусловия
Успешно проведен возврат денежных средств Клиента в Payture
<br>В Системе успешно сохранен результат возврата

## Основной поток
1. Клиент возвращает заказ в магазин
2. Администратор магазина забирает заказ
3. Администратор магазина совершает поиск нужного заказа в Системе
4. Администратор магазина оформляет возврат на заказ в Системе
5. Администратор магазина оформляет возврат денежных средств Клиенту за заказ
6. Система удерживает с суммы заказа - суммы доставки
7. Система отправляет в Payture операцию возврата денежных средств по платежу Клиента (с учетом удержания суммы доставки) - vwapi/Refund
8. Payture обрабатывает возврат
9. Payture передает в Систему результат обработки возврата
10. Система убеждается, что операция возврата прошла успешна
11. Система сохраняет результат возврата и отображает его Администратору магазина
12. Администратор магазина сообщает Клиент об успешном завершение возврата

## Расширения (Альтернатива, Исключения)
**3а. Нужный заказ не найден в Системе**
<br>3а.1 Система сообщает Администратору об отсутствии заказа и просит
ввести новый номер заказа.
<br>3а.1.1 Администратор вводит новый номер, сценарий продолжается с
шага 3.
<br>3а1.2 Администратор отменяет поиск заказа. Сценарий завершается.

4а. По возвращаемому заказу в Системе уже оформлен ранее возврат

4б. Срок возрата по заказу уже истек

5а. Карта клиента, которой был оплачен заказ, заблокирована или утрачена

6а. Сумма доставки не удерживается - Возврат выполняется до передачи заказа в доставку

7а. Сервис платежей Payture недоступен

10а. Статус платежа в Payture **не** Charged
